<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Admin</title>
	<style>

    </style>
    <script src="./javascripts/jquery-1.12.2.min.js"></script>
</head>
<body>
	<section>
		<!-- <form action="/submitxls" method="POST" enctype="multipart/form-data"> -->
			<input id="xlsfile" name="xlsfile" type="file" />
			<button onclick="submitFile()">submit</button>
		<!-- </form> -->
		<div class="progressBar" style="display: none">
		    <progress class="bar" value="0" max="100">0 %</progress>
		</div>
	</section>

	<script>
		$(document).ready(function() {

		});


		function submitFile() {
			var fd = new FormData();
			var fileEle = document.getElementById("xlsfile");
			fd.append("xls", fileEle.files[0]);

			// $.ajax({
			// 	url: "/submitxls",
			// 	type: "POST",
			// 	data: fd,
			// }).success(function(res) {
			// 	console.log(res);
			// });
			var bar = document.getElementsByTagName('progress')[0];
			bar.value = 0;
	        bar.text = '0%';
			$(".progressBar").toggle();
			
    		// var progressBar = document.getElementsByClassName('progressBar')[0];
        	var xhr = new XMLHttpRequest();
	        xhr.open("POST", "/submitxls");
	        // 文件上传过程的回调
	        xhr.upload.onprogress = function(e) {
	            console.log(Math.round((e.loaded/e.total)*100)+'%')
	            bar.value = Math.round((e.loaded/e.total)*100);
	            bar.text = bar.value + '%';
	        }

	        /**
	         *   e.loaded 文件已经上传了的大小
	         *   e.total  文件总大小
	          e.loaded/e.total)*100+'%'  转化成比例；
	         */
	        // 文件上传完毕的回调
	        xhr.upload.onloadend = function(e) {
	            console.log('接收完成'+e.loaded+'/'+e.total);
	            setTimeout(function(){
	                $(".progressBar").toggle();
	            },1000)
	        }
	        xhr.send(fd);
		}
	</script>
</body>
</html>